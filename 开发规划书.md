软件开发规划书：智能文件索引与整理助手 (Smart File Indexer)

1. 项目概述 (Project Overview)

目标：开发一款运行于 Windows 平台的轻量化文件管理工具。
核心场景：

资产盘点：针对本地磁盘及局域网共享文件夹（NAS/SMB），自动扫描并建立本地索引数据库。

极速检索：在不访问原始网络路径（慢速）的情况下，通过本地数据库（毫秒级）查询文件位置及属性。

AI 智能整理：利用大语言模型（LLM）对杂乱的文件名进行语义分析、分类和结构化整理，辅助用户进行服务器数据迁移和重建。

2. 技术架构栈 (Technical Stack)

编程语言：Python 3.10+ (兼顾开发效率与丰富的库支持)。

GUI 框架：PySide6 (Qt for Python) - 提供现代、高性能的桌面界面。

数据存储：SQLite3 - 单文件数据库，无需安装服务，支持百万级数据量，查询极快。

AI 接口：OpenAI SDK (支持接入 GPT-4o, Gemini, DeepSeek 等标准接口)。

打包工具：PyInstaller - 编译为独立的 .exe 文件。

3. 功能模块详解 (Functional Requirements)

3.1. 核心扫描模块 (The Scanner)

输入：支持用户添加多个扫描路径（例如 D:\Data 或 \\192.168.1.10\Public）。

执行逻辑：

多线程/异步：扫描过程必须在后台线程运行，确保 UI 不卡顿。

元数据采集：文件名 (Filename)、相对路径、绝对路径、扩展名、文件大小 (Bytes)、创建时间 (Ctime)、修改时间 (Mtime)。

网络优化：针对 UNC 网络路径，仅读取文件头属性，严禁计算 Hash 值或读取文件内容（防止网络堵塞）。

容错处理：遇到权限拒绝 (Permission Denied) 或路径过长时，记录错误日志并自动跳过，程序不可崩溃。

增量更新：再次扫描时，通过对比文件夹的修改时间，仅更新变动的部分（可选进阶功能）。

3.2. 数据存储模块 (The Database)

表结构设计 (Schema)：

CREATE TABLE files (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    filename TEXT,       -- 文件名
    extension TEXT,      -- 后缀 (如 .mkv)
    full_path TEXT,      -- 完整路径 (作为唯一索引或联合索引)
    parent_folder TEXT,  -- 父目录 (用于快速聚合)
    size_bytes INTEGER,  -- 大小
    mtime REAL,          -- 修改时间戳
    ai_category TEXT,    -- AI 分析后的分类 (如 "Movie", "Document")
    ai_tags TEXT         -- AI 分析后的标签 (如 "Marvel", "2024", "Backup")
);


3.3. 检索与展示模块 (The Explorer)

视图布局：

左侧：目录树结构（虚拟树，基于数据库路径生成，而非实时读取磁盘）。

右侧：文件详情列表（表格形式）。

搜索功能：

支持文件名模糊搜索 (SQL LIKE %keyword%)。

支持按大小排序、按扩展名筛选。

核心体验：搜索结果应瞬间展示原始路径，用户可右键点击“打开文件所在位置”（调用 Windows Explorer）。

3.4. AI 智能整理模块 (The AI Organizer)

这是本软件的核心差异化功能。

工作流程：

筛选：用户在软件内先圈定范围（例如：“扩展名为 .mp4 的所有文件”）。

构建 Prompt：软件将这批文件的文件名列表（JSON 格式）发送给 LLM。

Prompt 示例：“分析以下文件列表，识别出哪些是电影。输出 JSON，包含文件名、电影名称、年份、清晰度。”

处理与反馈：LLM 返回结构化数据。

应用：软件将 LLM 返回的标签（Tag）或分类（Category）写入数据库的 ai_tags 字段。

导出：用户可以点击“导出整理方案”，生成 CSV/Excel 表格，作为服务器重建的下载/拷贝清单。

4. 界面设计原型 (UI Concept)

主窗口：

[顶部工具栏]：添加扫描路径 | 开始扫描 | AI 整理助手 | 导出 CSV | 设置

[搜索栏]：输入框 + 高级筛选按钮

[主体内容]：

Tab 1: 文件浏览 (传统列表)

Tab 2: AI 视图 (基于 AI 标签的看板，例如自动分为 "电影", "剧集", "文档", "软件")

[底部状态栏]：显示文件总数、总大小、当前扫描进度。

5. 开发阶段规划 (Development Phases)

Phase 1: 基础架构 (MVP)

实现 SQLite 数据库连接。

实现本地及网络路径的递归扫描。

实现基础的列表展示和文件名搜索。

Phase 2: 交互优化

增加多线程扫描（防止界面假死）。

添加进度条。

实现“打开所在文件夹”交互。

Phase 3: AI 大脑接入

集成 OpenAI 格式的 API 客户端。

实现“批量文件名提取 -> 发送 AI -> 解析返回 JSON -> 更新数据库”的闭环。

实现按 AI 标签过滤显示。

Phase 4: 导出与交付

实现导出搜索结果为 Excel/CSV。

使用 PyInstaller 打包。

6. 特殊注意事项 (Critical Notes for AI Developer)

路径处理：Windows 路径分隔符 (\) 在 Python 字符串中需要转义，建议全程使用 pathlib 库处理路径。

网络延迟：访问 NAS 路径时，os.stat 可能会慢，需要有超时控制或异常捕获。

Token 优化：发送给 AI 时，只发送文件名和父文件夹名，不要发送无关的创建时间等信息，以节省 Token 并提高精度。